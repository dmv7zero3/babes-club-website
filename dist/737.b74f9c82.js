"use strict";(self.webpackChunkbabes_club_website=self.webpackChunkbabes_club_website||[]).push([[737],{3737:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var s=n(4848),i=n(6540),a=n(2638),l=n(8542);const r=({item:e})=>{const{updateQty:t,removeItem:n}=(0,a._)(),r=(0,i.useMemo)(()=>{if("number"==typeof e.unitPriceCents)return e.unitPriceCents;try{return(0,l.di)(e.variantId)}catch(e){return}},[e.unitPriceCents,e.variantId]),o=r?r*e.qty:void 0,c=[(0,i.useMemo)(()=>{switch(e.collectionId){case"necklaces":return"Necklace";case"earrings":return"Earrings";default:return e.collectionId.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())}},[e.collectionId]),...e.color&&e.color.trim().toLowerCase()!==e.name.trim().toLowerCase()?[e.color]:[]];return(0,s.jsxs)("div",{className:"flex items-center gap-3 py-3 border-b border-slate-200",children:[e.imageUrl&&(0,s.jsx)("img",{src:e.imageUrl,alt:e.name,className:"object-cover rounded-md w-14 h-14 ring-1 ring-slate-200"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("div",{className:"font-medium text-slate-900",children:e.name}),c.length>0&&(0,s.jsx)("div",{className:"text-sm text-slate-500",children:c.join(" · ")}),r&&(0,s.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:[(0,l.up)(r)," each",o&&o!==r?` · ${(0,l.up)(o)} total`:""]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"px-2 py-1 border rounded-md border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>t(e.variantId,e.qty-1),"aria-label":"Decrease quantity",children:"-"}),(0,s.jsx)("span",{className:"w-8 text-center text-slate-900",children:e.qty}),(0,s.jsx)("button",{className:"px-2 py-1 border rounded-md border-slate-300 text-slate-700 hover:bg-slate-100",onClick:()=>t(e.variantId,e.qty+1),"aria-label":"Increase quantity",children:"+"}),(0,s.jsx)("button",{className:"ml-2 text-slate-500 hover:text-babe-pink-600",onClick:()=>n(e.variantId),children:"Remove"})]})]})};var o=n(7359),c=n(2164);function d(e,t,n){const s=t.find(e=>n<e.minQty);if(!s)return;const i=s.minQty-n,a=s.minQty*e.basePriceCents,l=Math.max(0,a-s.totalPriceCents);return{minQty:s.minQty,missingQty:i,totalPriceCents:s.totalPriceCents,note:s.note,potentialSavingsCents:l}}var u=n(1205),m=function(e,t,n,s){return new(n||(n=Promise))(function(i,a){function l(e){try{o(s.next(e))}catch(e){a(e)}}function r(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,r)}o((s=s.apply(e,t||[])).next())})};class x extends Error{constructor(e,t,n){super(e),this.status=t,this.details=n,this.name="CommerceApiError"}}function p(e){return e.data}function h(e){var t;if(null==e?void 0:e.response){const{status:t,data:n}=e.response,s="string"==typeof(null==n?void 0:n.error)&&n.error||"string"==typeof(null==n?void 0:n.message)&&n.message||`Request failed with status ${t}`;throw new x(s,t,n)}if(e instanceof x)throw e;throw new x(null!==(t=null==e?void 0:e.message)&&void 0!==t?t:"Network request failed")}var v=n(3898),b=n(6459);const f=({open:e,onClose:t})=>{const{state:n}=(0,a._)(),[f,y]=i.useState("cart"),[g,j]=i.useState(null),[w,C]=i.useState(!1),[k,N]=i.useState(null),[I,S]=i.useState(null),q=i.useRef(null),T=i.useCallback(()=>{var e;null===(e=q.current)||void 0===e||e.abort(),q.current=null,C(!1),N(null),S(null)},[]),P=i.useCallback(e=>{const t=null!=e?e:(0,o.vu)(n);t&&0!==t.items.length?((0,o.Cu)(t),j(t),y("checkout"),N(null),S(null)):j(null)},[n]);i.useEffect(()=>{function e(){P()}function t(){const e=(0,o._F)();e&&P(e)}return window.addEventListener(b.hd,e),window.addEventListener(b.NL,t),()=>{window.removeEventListener(b.hd,e),window.removeEventListener(b.NL,t)}},[P]),i.useEffect(()=>{e||(y("cart"),T(),j(null))},[e,T]),i.useEffect(()=>()=>{var e;null===(e=q.current)||void 0===e||e.abort()},[]);const Q=function(e){const t=(0,l.Et)(e),n=function(e,t){var n,s,i,a;const l=new Map;for(const t of e){const e=c._f.find(e=>e.id===t.collectionId);if(!e)continue;const s=null!==(n=l.get(e.id))&&void 0!==n?n:{collection:e,quantity:0};s.quantity+=t.qty,l.set(e.id,s)}const r=new Map(t.discounts.map(e=>[e.collectionId,e])),o=[];for(const[e,{collection:t,quantity:n}]of l){const l=[...null!==(s=t.tieredPricing)&&void 0!==s?s:[]].sort((e,t)=>e.minQty-t.minQty),c=r.get(e);o.push({collectionId:e,title:t.title,quantity:n,discountCents:null!==(i=null==c?void 0:c.discountCents)&&void 0!==i?i:0,appliedBundles:null!==(a=null==c?void 0:c.appliedBundles)&&void 0!==a?a:[],nextTier:d(t,l,n)})}return o}(e,t),s=t.discounts.reduce((e,t)=>e+t.discountCents,0);return{quote:t,opportunities:n,totalDiscountCents:s}}(n.items.map(e=>({collectionId:e.collectionId,variantId:e.variantId,qty:e.qty}))),{quote:E,opportunities:_,totalDiscountCents:M}=Q,$=_.filter(e=>e.discountCents>0),D=_.filter(e=>e.nextTier&&e.nextTier.missingQty>0).sort((e,t)=>{var n,s;return(null!==(n=e.nextTier.missingQty)&&void 0!==n?n:0)-(null!==(s=t.nextTier.missingQty)&&void 0!==s?s:0)}),A=i.useMemo(()=>{var e;return null!==(e=null==g?void 0:g.items.reduce((e,t)=>e+t.qty,0))&&void 0!==e?e:0},[g]),L=i.useMemo(()=>{var e;return null!==(e=null==g?void 0:g.totals.discounts.reduce((e,t)=>e+t.discountCents,0))&&void 0!==e?e:0},[g]),U=i.useCallback(()=>{return e=void 0,t=void 0,s=function*(){var e;if(!g||w)return;null===(e=q.current)||void 0===e||e.abort();const t=new AbortController;q.current=t,C(!0),S(null),N("Calculating bundle savings…");try{const e=yield function(e,t){return m(this,void 0,void 0,function*(){try{const n=function(e){var t,n;const s=null!==(t=e.currency)&&void 0!==t?t:"USD";return{items:e.items.map(e=>({collectionId:e.collectionId,variantId:e.variantId,quantity:e.qty,name:e.name,unitAmount:"number"==typeof e.unitPriceCents?e.unitPriceCents/100:void 0,currency:s,options:e.options})),subtotal:"number"==typeof(null===(n=e.totals)||void 0===n?void 0:n.grandTotalCents)?e.totals.grandTotalCents/100:void 0,currency:s}}(e);return p(yield u.FH.post("/cart/quote",n,{signal:null==t?void 0:t.signal}))}catch(e){h(e)}})}(g,{signal:t.signal});N("Preparing secure checkout…");const n="undefined"!=typeof window?window.location.origin:void 0,s=n?`${n}/checkout/success?session_id={CHECKOUT_SESSION_ID}`:void 0,i=n?`${n}/checkout/cancel`:void 0,a=yield function(e,t){return m(this,void 0,void 0,function*(){try{return p(yield u.FH.post("/checkout/create-session",e,{signal:null==t?void 0:t.signal}))}catch(e){h(e)}})}({quoteSignature:e.quoteSignature,successUrl:s,cancelUrl:i,metadata:{cartItemsCount:String(A),cartSubtotalCents:String(g.totals.preDiscountTotalCents),cartGrandTotalCents:String(g.totals.grandTotalCents),normalizedHash:e.normalizedHash}},{signal:t.signal});if((0,v.W9)({payload:g,quote:e,session:a,storedAt:(new Date).toISOString()}),N("Redirecting to Stripe…"),"undefined"!=typeof window)return void(window.location.href=a.checkoutUrl)}catch(e){if("AbortError"===(null==e?void 0:e.name))return;return console.error("Checkout failed",e),S(e instanceof x?e.message:"We couldn't start your secure checkout just now. Please try again."),N(null),void C(!1)}C(!1)},new((n=void 0)||(n=Promise))(function(i,a){function l(e){try{o(s.next(e))}catch(e){a(e)}}function r(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,r)}o((s=s.apply(e,t||[])).next())});var e,t,n,s},[g,A,w]),W=i.useCallback(()=>{0!==n.items.length&&(T(),P())},[P,T,n.items.length]),z=i.useCallback(()=>{T(),y("cart")},[T]);return(0,s.jsxs)("div",{className:"fixed inset-0 z-[1000] "+(e?"":"pointer-events-none"),"aria-hidden":!e,children:[(0,s.jsx)("div",{className:"absolute inset-0 z-[999] bg-babe-pink/25 backdrop-blur-sm saturate-150 transition-opacity duration-300 ease-out "+(e?"opacity-100":"opacity-0"),onClick:()=>{t(),T(),y("cart")}}),(0,s.jsx)("aside",{className:`absolute right-0 top-0 z-[1000] h-full w-full max-w-md p-5 transition-transform duration-300 ease-out ${e?"translate-x-0":"translate-x-full"} bg-white/95 backdrop-blur-xl border-l border-babe-pink/20 shadow-[0_0_60px_rgba(254,59,161,0.35)] text-slate-900`,children:(0,s.jsxs)("div",{className:"relative z-10 flex flex-col h-full",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-2 pb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"cart"===f?"Your Cart":"Secure Checkout"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"cart"===f?"Review your selections and bundle savings.":"We’ll redirect you to Stripe to finish payment."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["checkout"===f&&(0,s.jsx)("button",{type:"button",className:"px-3 py-1 text-xs font-medium transition border rounded-full border-slate-200 text-slate-600 hover:border-slate-300 hover:text-slate-900",onClick:z,children:"Back"}),(0,s.jsx)("button",{onClick:()=>{t(),T(),y("cart")},"aria-label":"Close",className:"text-2xl leading-none transition text-slate-600 hover:text-slate-900",children:"×"})]})]}),(0,s.jsx)("div",{className:"flex-1 pr-1 overflow-y-auto",children:"cart"===f?0===n.items.length?(0,s.jsx)("div",{className:"opacity-70",children:"Your cart is empty."}):n.items.map(e=>(0,s.jsx)(r,{item:e},e.variantId)):g?(0,s.jsxs)("div",{className:"pb-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Items"}),(0,s.jsx)("ul",{className:"mt-2 space-y-2 text-sm",children:g.items.map(e=>{var t,n;return(0,s.jsxs)("li",{className:"flex items-center justify-between px-3 py-2 border rounded-lg shadow-sm border-white/40 bg-white/60",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-900",children:null!==(t=e.name)&&void 0!==t?t:e.variantId}),(0,s.jsxs)("p",{className:"text-[11px] uppercase tracking-[0.25em] text-slate-500",children:["Qty ",e.qty," · ",e.collectionId]})]}),(0,s.jsx)("span",{className:"font-semibold",children:(0,l.up)((null!==(n=e.unitPriceCents)&&void 0!==n?n:0)*e.qty)})]},`${e.variantId}-${e.qty}`)})})]}),(0,s.jsxs)("div",{className:"p-4 space-y-2 text-sm border rounded-lg shadow-sm border-slate-200 bg-white/70",children:[(0,s.jsxs)("div",{className:"flex justify-between text-slate-600",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsx)("span",{children:(0,l.up)(g.totals.preDiscountTotalCents)})]}),g.totals.discounts.map(e=>(0,s.jsxs)("div",{className:"flex justify-between text-emerald-600",children:[(0,s.jsxs)("span",{children:[e.collectionId," savings"]}),(0,s.jsxs)("span",{children:["-",(0,l.up)(e.discountCents)]})]},e.collectionId)),(0,s.jsxs)("div",{className:"flex justify-between text-base font-semibold text-slate-900",children:[(0,s.jsx)("span",{children:"Grand Total"}),(0,s.jsx)("span",{children:(0,l.up)(g.totals.grandTotalCents)})]})]}),(0,s.jsx)("div",{className:"px-4 py-3 text-xs border rounded-lg shadow-sm border-emerald-200/70 bg-emerald-50 text-emerald-800",children:L>0?(0,s.jsxs)("p",{children:["We’ll automatically apply"," ",(0,l.up)(L)," in bundle savings during payment with a one-time Stripe coupon."]}):(0,s.jsx)("p",{children:"Mix and match pieces from the same collection to unlock bundle savings automatically at checkout."})})]}):(0,s.jsx)("div",{className:"px-3 py-3 text-sm border rounded-lg border-rose-200/70 bg-rose-50 text-rose-700",children:"We couldn’t restore your checkout details. Add items to your cart and try again."})}),(0,s.jsx)("div",{className:"pt-4 mt-4 space-y-3 text-sm border-t border-slate-200",children:"cart"===f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex justify-between text-slate-700",children:[(0,s.jsx)("span",{children:"Subtotal"}),(0,s.jsx)("span",{children:(0,l.up)(E.preDiscountTotalCents)})]}),$.map(e=>(0,s.jsxs)("div",{className:"flex items-start justify-between text-emerald-600",children:[(0,s.jsxs)("span",{className:"pr-2",children:["Bundle savings · ",e.title,e.appliedBundles.map(e=>` • ${e.tierMinQty} for ${(0,l.up)(e.tierTotalPriceCents)} x${e.bundleCount}`).join("")||""]}),(0,s.jsxs)("span",{children:["-",(0,l.up)(e.discountCents)]})]},e.collectionId)),(0,s.jsxs)("div",{className:"flex justify-between text-base font-semibold",children:[(0,s.jsx)("span",{children:"Total"}),(0,s.jsx)("span",{children:(0,l.up)(E.grandTotalCents)})]}),(0,s.jsx)("div",{className:"px-3 py-2 text-xs border rounded-lg shadow-sm border-emerald-200/70 bg-emerald-50 text-emerald-800",children:M>0?(0,s.jsxs)("p",{children:["We’ll automatically apply"," ",(0,l.up)(M)," in bundle savings at payment using a one-time Stripe coupon."]}):D.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{className:"font-medium text-emerald-900",children:"Almost there!"}),D.slice(0,1).map(e=>(0,s.jsxs)("p",{children:["Add ",e.nextTier.missingQty," more from the"," ",e.title," collection to unlock"," ",e.nextTier.minQty," for"," ",(0,l.up)(e.nextTier.totalPriceCents)," (save up to ",(0,l.up)(e.nextTier.potentialSavingsCents),")."]},e.collectionId))]}):(0,s.jsx)("p",{children:"Mix and match pieces from the same collection to unlock bundle savings automatically at checkout."})}),D.length>1&&(0,s.jsx)("div",{className:"space-y-1 text-xs text-slate-500",children:D.slice(1).map(e=>(0,s.jsxs)("p",{children:[e.nextTier.missingQty," more from ",e.title," →"," ",e.nextTier.minQty," for"," ",(0,l.up)(e.nextTier.totalPriceCents)]},e.collectionId))}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"Taxes and shipping (if any) are calculated in Stripe Checkout."}),(0,s.jsx)("button",{type:"button",className:"block w-full py-3 font-semibold text-center text-white transition rounded-lg shadow-md bg-babe-pink hover:bg-babe-pink-600 focus:outline-none focus:ring-2 focus:ring-babe-pink/40 disabled:cursor-not-allowed disabled:opacity-70",onClick:W,disabled:0===n.items.length,children:"Continue to checkout"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"button",className:"block w-full py-3 font-semibold text-center text-white transition rounded-lg shadow-md bg-babe-pink hover:bg-babe-pink-600 focus:outline-none focus:ring-2 focus:ring-babe-pink/40 disabled:cursor-not-allowed disabled:opacity-70",disabled:w||!g,onClick:U,children:w?"Redirecting to Stripe…":"Secure checkout"}),(0,s.jsx)("p",{className:"text-xs text-slate-500",children:"We’ll send you to Stripe Checkout to finish payment and apply your bundle savings automatically."}),k&&(0,s.jsx)("p",{className:"text-xs text-emerald-600","aria-live":"polite",children:k}),I&&(0,s.jsx)("p",{className:"text-xs text-rose-600","aria-live":"assertive",children:I})]})})]})})]})}}}]);
//# sourceMappingURL=737.b74f9c82.js.map